// ==UserScript==
// @name         TEMUHOOK
// @namespace    SAN
// @version      3.2
// @description  TEMUHOOK 提交
// @author       XIAOSAN
// @match        *://seller.kuajingmaihuo.com/*
// @match        *://agentseller.temu.com/*
// @match        *://*.temu.com/*
// @homepageURL  https://www.baidu.com
// @updateURL    https://raw.githubusercontent.com/crazyUFO/TEMUHOOK/refs/heads/main/dist/main.min.js
// @downloadURL  https://raw.githubusercontent.com/crazyUFO/TEMUHOOK/refs/heads/main/dist/main.min.js
// @require      https://cdn.jsdelivr.net/npm/vue@3.5.13/dist/vue.global.min.js
// @require      data:application/javascript,unsafeWindow.Vue%3DVue%2Cthis.Vue%3DVue%3B
// @require      https://cdn.jsdelivr.net/npm/element-plus@2.9.5/dist/index.full.min.js
// @resource     ELEMENT_CSS https://cdn.jsdelivr.net/npm/element-plus@2.9.5/dist/index.min.css
// @grant        unsafeWindow
// @grant        GM_getResourceText
// @grant        GM_addStyle
// @grant        GM_getValue
// @grant        GM_setValue
// @grant        GM_xmlhttpRequest
// ==/UserScript==
!function(){"use strict";const e=GM_getResourceText("ELEMENT_CSS");GM_addStyle(e),GM_addStyle('\n        #vueApp{\n            position: fixed;\n            top: 50%;\n            right: 30px;\n            z-index: 99999;\n        }\n        #vueApp .fix-tabs{\n            display: flex;\n            flex-direction: column-reverse;\n        }\n        .el-tag + .el-tag {\n          margin-left: 10px;\n        }\n        #vueApp .logBox{\n            margin-bottom: 20px;\n            max-height: 300px;\n            overflow: auto;\n        }\n        #vueApp .process-progress{\n            display: flex;\n            flex-wrap: wrap;\n            gap: 10px;\n            margin-top: 10px;\n            justify-content: space-between;\n            align-items: center;\n        }\n        .is-blockPopUps [data-testid="beast-core-modal-mask"],\n        .is-blockPopUps [data-testid="beast-core-modal"]{\n            display: none !important;\n        }\n        .el-overlay.is-message-box {\n          z-index: 999999 !important; /* 例如 3000 */\n        }\n    ');let t=document.createElement("div");t.innerHTML='\n        <div id="vueApp">\n            <el-button type="info" @click="openPanl">TEMUHOOK</el-button>\n\n            <el-drawer v-model="settingDrawer" title="设置面板" :with-header="false" >\n\n                <el-tabs type="border-card" class="fix-tabs" v-model="currentTab">\n\x3c!--                     <el-tab-pane label="全局">\n                        <el-form :model="configSetting" label-width="auto">\n                            <el-form-item label="隐藏弹窗">\n                                <el-switch v-model="configSetting.blockPopUps" :disabled="fetchState" />\n                            </el-form-item>\n                            <el-form-item label="页面大小">\n                                <el-input v-model="configSetting.pageSize" :disabled="fetchState" />\n                            </el-form-item>\n                            <el-form-item label="起始页码">\n                                <el-input v-model="configSetting.pageNum" :disabled="fetchState" />\n                            </el-form-item>\n                            <el-form-item label="自动翻页">\n                                <el-switch v-model="configSetting.autoPage" :disabled="fetchState" />\n                            </el-form-item>\n                            <el-form-item label="等待时间">\n                                <el-input v-model="configSetting.waitSeconds" :disabled="fetchState" />\n                            </el-form-item>\n                        </el-form>\n                    </el-tab-pane> --\x3e\n                    <el-tab-pane label="上新生命周期" name="SMZQ">\n                        <el-form :model="configSetting" label-width="auto">\n                            <el-table :data="configSetting.abandonPriceRule" style="width: 100%">\n                                <el-table-column label="价格(分)">\n                                    <template #default="scope">\n                                        <el-input-number v-model="scope.row.price" :min="0" :precision="0" :disabled="fetchState" controls-position="right" />\n                                    </template>\n                                </el-table-column>\n                                <el-table-column label="最高价格(分)">\n                                    <template #default="scope">\n                                        <el-input-number v-model="scope.row.maxPrice" :min="0" :precision="0" :disabled="fetchState" controls-position="right" />\n                                    </template>\n                                </el-table-column>\n                                <el-table-column label="" width="100">\n                                    <template #default="scope">\n                                        <el-button size="small" type="danger" @click="SMZQ_abandonPriceRuleDelete(scope.$index, scope.row)" :disabled="fetchState">\n                                        Delete\n                                        </el-button>\n                                    </template>\n                                </el-table-column>\n                            </el-table>\n                            <div style="margin-top: 30px;">\n                                <el-button type="info" @click="SMZQ_abandonPriceRuleAdd" :disabled="configSetting.abandonPriceRule.length > 0">添加金额规则</el-button>\n                            </div>\n                        </el-form>\n                    </el-tab-pane>\n                    <el-tab-pane label="活动申报" name="HDSB">\n                        <el-form :model="configSetting" label-width="auto">\n                            <el-table :data="configSetting.activityPriceRule" style="width: 100%">\n                                <el-table-column label="价格(分)">\n                                    <template #default="scope">\n                                        <el-input-number v-model="scope.row.price" :min="0" :precision="0" :disabled="fetchState" controls-position="right" />\n                                    </template>\n                                </el-table-column>\n                                <el-table-column label="最高价格(分)">\n                                    <template #default="scope">\n                                        <el-input-number v-model="scope.row.maxPirce" :min="0" :precision="0" :disabled="fetchState" controls-position="right" />\n                                    </template>\n                                </el-table-column>\n                                <el-table-column label="" width="100">\n                                    <template #default="scope">\n                                        <el-button size="small" type="danger" @click="HDSB_activityPirceDelete(scope.$index, scope.row)" :disabled="fetchState">\n                                        Delete\n                                        </el-button>\n                                    </template>\n                                </el-table-column>\n                            </el-table>\n                            <div style="margin-top: 30px;">\n                                <el-button type="info" @click="HDSB_activityPirceAdd" :disabled="configSetting.activityPriceRule.length > 0">添加金额规则</el-button>\n                            </div>\n                        <el-divider>过滤字符</el-divider>\n                            <el-table :data="configSetting.activityFilerStrRule" style="width: 100%">\n                                <el-table-column label="SKU/SKC属性集">\n                                    <template #default="scope">\n                                        <el-input v-model="scope.row.str"  :disabled="fetchState" controls-position="right" />\n                                    </template>\n                                </el-table-column>\n                                <el-table-column label="" width="100">\n                                    <template #default="scope">\n                                        <el-button size="small" type="danger" @click="HDSB_activityFilerStrDel(scope.$index, scope.row)" :disabled="fetchState">\n                                        Delete\n                                        </el-button>\n                                    </template>\n                                </el-table-column>\n                            </el-table>\n                            <div style="margin-top: 30px;">\n                                <el-button type="info" @click="HDSB_activityFilerStrAdd">添加字符匹配过滤</el-button>\n                            </div>\n                          <el-divider>筛选字符</el-divider>\n                            <el-table :data="configSetting.activitySelectStrRule" style="width: 100%">\n                                <el-table-column label="SKU/SKC属性集">\n                                    <template #default="scope">\n                                        <el-input v-model="scope.row.str"  :disabled="fetchState" controls-position="right" />\n                                    </template>\n                                </el-table-column>\n                                <el-table-column label="" width="100">\n                                    <template #default="scope">\n                                        <el-button size="small" type="danger" @click="HDSB_activitySelectStrDel(scope.$index, scope.row)" :disabled="fetchState">\n                                        Delete\n                                        </el-button>\n                                    </template>\n                                </el-table-column>\n                            </el-table>\n                            <div style="margin-top: 30px;">\n                                <el-button type="info" @click="HDSB_activitySelectStrAdd">添加字符匹配筛选</el-button>\n                            </div>\n                        <el-divider>活动库存</el-divider>\n                            <el-table :data="configSetting.activityTargetActivityStock" style="width: 100%">\n                                <el-table-column label="库存数量">\n                                    <template #default="scope">\n                                        <el-input v-model="scope.row.num"  :disabled="fetchState" controls-position="right" />\n                                    </template>\n                                </el-table-column>\n                                <el-table-column label="" width="100">\n                                    <template #default="scope">\n                                        <el-button size="small" type="danger" @click="HDSB_activityTargetActivityStockDel(scope.$index, scope.row)" :disabled="fetchState">\n                                        Delete\n                                        </el-button>\n                                    </template>\n                                </el-table-column>\n                            </el-table>\n                            <div style="margin-top: 30px;">\n                                <el-button type="info" @click="HDSB_activityTargetActivityStockAdd" :disabled="configSetting.activityTargetActivityStock.length > 0">添加数量</el-button>\n                            </div>\n                        </el-form>\n                        \n                    </el-tab-pane>\n                    <el-tab-pane label="广告投放" name="ADTF">\n                    <el-divider content-position="center">地区({{ADTF_currentSiteName}}) <el-button type="text" :disabled="advertSites.length == 0" @click="dialogAdvertSiteVisible = true">更改</el-button></el-divider> \n                    <el-divider>商品价格规则</el-divider>\n                        <el-form :model="configSetting" label-width="auto">\n                            <el-table :data="configSetting.advertPriceRule" style="width: 100%">\n                                <el-table-column label="最低价格(分)">\n                                    <template #default="scope">\n                                        <el-input-number v-model="scope.row.price" :min="0" :precision="0" :disabled="fetchState" controls-position="right" />\n                                    </template>\n                                </el-table-column>\n                                <el-table-column label="最高价格(分)">\n                                    <template #default="scope">\n                                        <el-input-number v-model="scope.row.maxPrice" :min="0" :precision="0" :disabled="fetchState" controls-position="right" />\n                                    </template>\n                                </el-table-column>\n                                <el-table-column label="" width="100">\n                                    <template #default="scope">\n                                        <el-button size="small" type="danger" @click="ADTF_advertPriceRuleDelete(scope.$index, scope.row)" :disabled="fetchState">\n                                        Delete\n                                        </el-button>\n                                    </template>\n                                </el-table-column>\n                            </el-table>\n                            <div style="margin-top: 30px;">\n                                <el-button type="info" @click="ADTF_advertPriceRuleAdd" :disabled="configSetting.advertPriceRule.length > 0">Add</el-button>\n                            </div>\n                        </el-form>\n                        <el-divider>预算&回报率</el-divider>\n                        <el-form :model="configSetting" label-width="auto">\n                            <el-table :data="configSetting.advertBudgetRule" style="width: 100%">\n                                <el-table-column label="预算金额(分)">\n                                    <template #default="scope">\n                                        <el-input-number v-model="scope.row.budget" :min="0" :precision="0" :disabled="fetchState" controls-position="right" />\n                                    </template>\n                                </el-table-column>\n                                <el-table-column label="回报率">\n                                    <template #default="scope">\n                                        <el-input-number  v-model="scope.row.roas" :min="0" :precision="2" :disabled="fetchState" controls-position="right" />\n                                    </template>\n                                </el-table-column>\n                                <el-table-column label="" width="100">\n                                    <template #default="scope">\n                                        <el-button size="small" type="danger" @click="ADTF_advertBudgetRuleDelete(scope.$index, scope.row)" :disabled="fetchState">\n                                        Delete\n                                        </el-button>\n                                    </template>\n                                </el-table-column>\n                            </el-table>\n                            <div style="margin-top: 30px;">\n                                <el-button type="info" @click="ADTF_advertBudgetRuleAdd" :disabled="configSetting.advertBudgetRule.length > 0">Add</el-button>\n                            </div>\n                        </el-form>\n                    </el-tab-pane>\n                </el-tabs>\n                <div style="margin-top: 30px;" v-if="siteList.length && currentTab!=\'ADTF\'">\n                  <el-divider content-position="left">选择站点 <el-button type="text" :disabled="siteList.length == 0" @click="showSiteDialog">更改</el-button></el-divider>\n                  \x3c!--<template v-if="siteList.length"><el-tag size="small" v-for="val in configSetting.checkedSites" :key="val">{{siteLabel(val) }}</el-tag></template>--\x3e\n                  <el-tag size="small" v-if="configSetting.checkedSites" >{{siteLabel(configSetting.checkedSites) }}</el-tag>\n                </div>\n                <div style="margin-top: 30px;" v-if="malInfoList.length && currentTab!=\'ADTF\'">\n                <el-divider  content-position="left">选择店铺</el-divider> \n                <el-radio-group v-model="configSetting.mallId">\n                        <el-radio v-for="item in malInfoList" :key="item.mallId" :value="item.mallId" :disabled="fetchState">{{item.mallName}}</el-radio>\n                    </el-radio-group>\n                </div>\n\x3c!--                 <div style="margin-top: 30px;">\n                    <el-button type="info" @click="dialogLogVisible = true">日志</el-button>\n                <div> --\x3e\n\n\n                <div style="margin-top: 30px;">\n                  <el-button v-if="currentTab == \'SMZQ\' && getUserInfoState && configSetting.mallId" :loading="fetchState" type="primary" @click="handleClick(\'上新生命周期\')">上新生命周期</el-button>\n                  <el-button v-else-if="currentTab == \'HDSB\' && getUserInfoState && configSetting.mallId" :loading="fetchState" type="primary" @click="handleClick(\'批量活动申报\')">批量活动申报</el-button>\n                  <el-button v-else-if="currentTab == \'ADTF\'" :loading="fetchState" type="primary" @click="handleClick(\'批量广告投放\')">批量活动申报</el-button>\n                  \x3c!-- <el-button type="info" @click="handleClick(\'批量签署JIT规则\')">批量签署JIT规则</el-button> --\x3e\n                </div>\n\n            </el-drawer>\n\n            <el-dialog v-model="dialogLogVisible" :title="\'日志: \' + clickState" destroy-on-close>\n                <template v-if="clickState == \'上新生命周期\'">\n                    <div class="logBox" v-if="logList.length">\n                        <ul>\n                            <li v-for="item in logList">\n                                {{item.text}}\n                            </li>\n                        </ul>\n                    </div>\n                    <template v-if="logInfo.totals > 0">\n                        <div><el-progress :percentage="Number((logInfo.index / logInfo.totals * 100).toFixed(2))" /></div>\n                        <div class="process-progress"><span>任务进度: {{logInfo.text}}</span><span>{{logInfo.index}}/{{logInfo.totals}}</span></div>\n                    </template>\n                </template>\n                <template v-if="clickState == \'批量签署JIT规则\'">\n                    <div class="logBox" v-if="logList.length">\n                        <ul>\n                            <li v-for="item in logList">\n                                {{item.text}}\n                            </li>\n                        </ul>\n                    </div>\n                </template>\n                <template v-if="clickState == \'批量活动申报\'">\n                    <div class="logBox" v-if="logList.length">\n                        <ul>\n                            <li v-for="item in logList">\n                                {{item.text}}\n                            </li>\n                        </ul>\n                    </div>\n                </template>\n                <template v-if="clickState == \'批量广告投放\'">\n                    <div class="logBox" v-if="logList.length">\n                        <ul>\n                            <li v-for="item in logList">\n                                {{item.text}}\n                            </li>\n                        </ul>\n                    </div>\n                </template>\n            </el-dialog>\n\n            <el-dialog v-model="dialogSiteVisible" title="选择地区" destroy-on-close>\n              \x3c!--<el-checkbox-group v-model="configSetting.checkedSites" >\n                  <el-checkbox v-for="val in siteList" :label="val.siteId" :key="val.siteId">{{val.siteName}}</el-checkbox>\n              </el-checkbox-group>--\x3e\n                <el-radio-group v-model="configSetting.checkedSites" @change="dialogSiteVisible = false">\n                  <el-radio v-for="val in siteList" :label="val.siteId" :key="val.siteId">{{val.siteName}}</el-radio>\n              </el-radio-group>\n            </el-dialog>\n\n            <el-dialog v-model="dialogAdvertSiteVisible" title="选择地区" destroy-on-close>\n                <el-radio-group v-model="advertCurrentSiteId" @change="dialogAdvertSiteVisible = false">\n                  <el-radio v-for="val in advertSites" :label="val.site_id" :key="val.site_id">{{val.site_name}}</el-radio>\n              </el-radio-group>\n            </el-dialog>\n        </div>\n    ',console.log(document.cookie),document.body.append(t);const i={data:()=>({settingDrawer:!1,currentTab:"SMZQ",dialogLogVisible:!1,dialogSiteVisible:!1,dialogAdvertSiteVisible:!1,selectedActivity:"",advertSites:[],advertCurrentSiteId:0,siteList:[{siteId:100,siteName:"美国站",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:101,siteName:"加拿大站",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:102,siteName:"英国站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:103,siteName:"澳大利亚站",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:104,siteName:"新西兰站",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:105,siteName:"德国站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:106,siteName:"法国站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:107,siteName:"意大利站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:108,siteName:"荷兰站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:109,siteName:"西班牙站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:110,siteName:"墨西哥站",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:111,siteName:"葡萄牙站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:112,siteName:"波兰站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:113,siteName:"瑞典站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:114,siteName:"瑞士站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:115,siteName:"希腊",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:116,siteName:"爱尔兰",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:117,siteName:"塞浦路斯",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:118,siteName:"日本站",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:119,siteName:"韩国站",dr:"us",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:120,siteName:"沙特站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:121,siteName:"新加坡站",dr:"us",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:122,siteName:"阿联酋站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:123,siteName:"科威特站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:124,siteName:"挪威站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:125,siteName:"智利站",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:126,siteName:"马来西亚站",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:127,siteName:"菲律宾站",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:128,siteName:"中国台湾站",dr:"us",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:129,siteName:"泰国站",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:130,siteName:"卡塔尔站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:131,siteName:"约旦站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:132,siteName:"巴西站",dr:"us",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:133,siteName:"阿曼站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:134,siteName:"巴林站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:135,siteName:"以色列站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:136,siteName:"南非站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:141,siteName:"保加利亚站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:137,siteName:"捷克站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:138,siteName:"匈牙利站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:139,siteName:"丹麦站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:140,siteName:"罗马尼亚站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:142,siteName:"比利时站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:143,siteName:"奥地利站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:144,siteName:"芬兰站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:145,siteName:"斯洛伐克站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:146,siteName:"克罗地亚站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:147,siteName:"斯洛文尼亚站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:148,siteName:"立陶宛站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:149,siteName:"爱沙尼亚站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:150,siteName:"拉脱维亚站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:151,siteName:"马耳他站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:152,siteName:"卢森堡站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!0},{siteId:153,siteName:"塞尔维亚",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:154,siteName:"摩尔多瓦",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:155,siteName:"黑山",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:156,siteName:"冰岛",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:157,siteName:"安道尔",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:158,siteName:"波黑",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:159,siteName:"阿尔巴尼亚",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:160,siteName:"北马其顿-已废弃",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:162,siteName:"哈萨克斯坦",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:163,siteName:"秘鲁",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:164,siteName:"哥伦比亚",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:165,siteName:"格鲁吉亚",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:166,siteName:"亚美尼亚",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:167,siteName:"阿塞拜疆",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:168,siteName:"乌克兰",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:169,siteName:"乌拉圭",dr:"us",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:161,siteName:"科索沃",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:170,siteName:"毛里求斯",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:171,siteName:"摩洛哥",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:172,siteName:"多米尼加",dr:"us",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:173,siteName:"哥斯达黎加",dr:"us",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:174,siteName:"土耳其",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:175,siteName:"阿尔及利亚站",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:176,siteName:"巴拿马站",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:177,siteName:"肯尼亚站",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:178,siteName:"厄瓜多尔站",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:179,siteName:"特立尼达和多巴哥站",dr:"us",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:180,siteName:"危地马拉站",dr:"us",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:181,siteName:"乌兹别克斯坦站",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:182,siteName:"洪都拉斯站",dr:"us",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:183,siteName:"萨尔瓦多站",dr:"us",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:184,siteName:"巴基斯坦站",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:185,siteName:"斯里兰卡站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:186,siteName:"蒙古站",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:187,siteName:"越南站",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:188,siteName:"文莱站",dr:"us",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:189,siteName:"阿根廷站",dr:"us",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:190,siteName:"尼日利亚站",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:191,siteName:"柬埔寨站",dr:"us",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:192,siteName:"北马其顿",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:193,siteName:"孟加拉站",dr:"us",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:194,siteName:"吉尔吉斯斯坦站",dr:"eu",matchSemiManaged:!0,matchPreSemiHosting:!1},{siteId:196,siteName:"马尔代夫站",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:197,siteName:"列支敦士登站",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:198,siteName:"加纳站",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:199,siteName:"埃及站",dr:"eu",matchSemiManaged:!1,matchPreSemiHosting:!1},{siteId:200,siteName:"巴拉圭站",dr:"us",matchSemiManaged:!1,matchPreSemiHosting:!1}],configSetting:Object.assign({Cookie:"",blockPopUps:!1,pageSize:100,pageNum:1,autoPage:!0,waitSeconds:5,abandonPriceRule:[],activityPriceRule:[],activityFilerStrRule:[],activitySelectStrRule:[],activityTargetActivityStock:[],advertPriceRule:[],advertBudgetRule:[],token:null,checkedSites:null},GM_getValue("configSetting"),{Cookie:document.cookie}),getUserInfoState:!1,clickState:"",fetchState:!1,malInfoList:[],activityList:[],currentActivity:25022164983552,logList:[],logInfo:{index:0,totals:0,text:""}}),mounted(){this.$nextTick((async()=>{this.ADTF_getSites(),await this.getUserInfo(),this.getSiteList(),this.HDSB_getActivityList();const e=unsafeWindow.document.body;this.configSetting.blockPopUps&&e.classList.add("is-blockPopUps"),this.configSetting}))},methods:{ADTF_getSites:async function(e){const t=this.configSetting,i={page_number:1,page_size:1,is_gray:!1,list_id:this.generateUUIDv4()};return fetch("/api/v1/coconut/ad/query_mall_goods_list",{method:"POST",headers:{"Content-Type":"application/json",Cookie:t.Cookie},body:JSON.stringify(i)}).then((e=>e.json())).then((e=>{if(e.success){const{site_info_list:t}=e.result;this.advertSites=t}else console.warn(`获取广告投放的站点失败: ${e.errorMsg}`)})).catch((e=>console.error("获取广告投放的站点失败:",e)))},ADTF_getDataList:function(e){const t=this.configSetting,{site_id:i,page_size:n,page_number:a,list_id:s}=e,o={page_number:a,page_size:n,is_gray:!1,list_id:s};return i&&(o.selected_site_id=i),fetch("/api/v1/coconut/ad/query_mall_goods_list",{method:"POST",headers:{"Content-Type":"application/json",Cookie:t.Cookie},body:JSON.stringify(o)}).then((e=>e.json()))},openPanl:async function(){await this.checkToken()&&(this.settingDrawer=!0)},login(){this.$prompt("输入令牌","提示",{confirmButtonText:"确定",cancelButtonText:"取消",customClass:"login-message-box",inputPattern:/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/,inputErrorMessage:"输入令牌格式不正确"}).then((({value:e})=>{GM_xmlhttpRequest({url:"http://81.69.13.209:8765/login",method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify({username:e}),onload:t=>{console.log(t),200==t.status?(this.configSetting.token=e,this.$message({type:"success",message:"你的令牌是: "+e}),this.settingDrawer=!0):(this.$message({type:"error",message:"没有此令牌"}),setTimeout((()=>{this.login()}),1e3))},onerror:e=>{console.error("Error:",e)}})})).catch((()=>{this.$message({type:"error",message:"取消输入"})}))},checkToken:async function(){return new Promise(((e,t)=>{if(!this.configSetting.token)return this.login(),void e(!1);GM_xmlhttpRequest({url:"http://81.69.13.209:8765/protected",method:"GET",headers:{"X-Username":this.configSetting.token},onload:t=>{200===t.status?e(!0):(this.configSetting.token=null,this.login(),this.$message({type:"error",message:"失效的令牌"}),e(!1))},onerror:t=>{console.error("Error:",t),e(!1)}})}))},HDSB_getMatch:function(e){const t=this.configSetting,i=new URLSearchParams(window.location.search);let n=i.get("type");const a={activityThematicId:1*i.get("thematicId"),activityType:1*n,addSite:!0,rowCount:50};return e&&(a.searchScrollContext=e),fetch("https://agentseller.temu.com/api/kiana/gamblers/marketing/enroll/semi/scroll/match",{method:"POST",headers:{"Content-Type":"application/json",Cookie:t.Cookie,mallid:t.mallId},body:JSON.stringify(a)}).then((e=>e.json()))},HDSB_submit:async function(e){const t=this.configSetting,i=new URLSearchParams(window.location.search);let n=i.get("type");const a={activityThematicId:i.get("thematicId"),activityType:n,productList:e};return fetch("https://agentseller.temu.com/api/kiana/gamblers/marketing/enroll/semi/submit",{method:"POST",headers:{"Content-Type":"application/json",Cookie:t.Cookie,mallid:t.mallId},body:JSON.stringify(a)}).then((e=>e.json()))},ADTF_submit:async function(e){const t=this.configSetting,i={create_ad_reqs:e};return fetch("/api/v1/coconut/ad/create_ads/create",{method:"POST",headers:{"Content-Type":"application/json",Cookie:t.Cookie},body:JSON.stringify(i)}).then((e=>e.json()))},HDSB_getActivityList:function(){const e=this.configSetting;fetch("https://seller.kuajingmaihuo.com/marvel-mms/cn/api/kiana/gambit/marketing/enroll/activity/list",{method:"POST",headers:{"Content-Type":"application/json",Cookie:e.Cookie,mallid:e.mallId},body:JSON.stringify({needCanEnrollCnt:!0,needSessionItem:!0})}).then((e=>e.json())).then((e=>{if(e.success){let t=[];e.result.activityList.forEach((e=>{t=t.concat(e.thematicList)})),this.activityList=t}else console.warn(`获取活动列表失败: ${e.errorMsg}`)})).catch((e=>{console.error("获取活动列表失败: ",e)}))},waitSeconds:function(e){return new Promise((t=>setTimeout(t,1e3*e)))},getUserInfo:function(){switch(window.location.host){case"seller.kuajingmaihuo.com":default:this.getUserInfo_seller_kuajingmaihuo_com();break;case"agentseller.temu.com":this.getUserInfo_agentseller_temu_com()}},getUserInfo_seller_kuajingmaihuo_com:async function(){const e=this.configSetting;fetch("https://seller.kuajingmaihuo.com/bg/quiet/api/mms/userInfo",{method:"POST",headers:{"Content-Type":"application/json",Cookie:e.Cookie},body:JSON.stringify({})}).then((e=>e.json())).then((e=>{e.success?(this.malInfoList=e.result.companyList[0].malInfoList,this.configSetting.mallId=this.malInfoList[0].mallId,this.getUserInfoState=!0):console.warn(`获取用户信息失败: ${e.errorMsg}`)})).catch((e=>{console.error("获取用户信息失败: ",e)}))},getUserInfo_agentseller_temu_com:async function(){const e=this.configSetting;fetch("https://agentseller.temu.com/api/seller/auth/userInfo",{method:"POST",headers:{"Content-Type":"application/json",Cookie:e.Cookie},body:JSON.stringify({})}).then((e=>e.json())).then((e=>{e.success?(this.malInfoList=e.result.mallList,this.configSetting.mallId=this.malInfoList[0].mallId,this.getUserInfoState=!0):console.warn(`获取用户信息失败: ${e.errorMsg}`)})).catch((e=>{console.error("获取用户信息失败: ",e)}))},getSiteList:function(){const e=this.configSetting;fetch("https://seller.kuajingmaihuo.com/bg-visage-mms/config/common/site/query",{method:"POST",headers:{"Content-Type":"application/json",Cookie:e.Cookie,mallid:e.mallId},body:JSON.stringify({})}).then((e=>e.json())).then((e=>{e.success?this.siteList=e.result.siteBaseList:console.warn(`获取站点列表失败: ${e.errorMsg}`)})).catch((e=>{console.error("获取站点列表失败: ",e)}))},showSelectSite:function(){this.dialogSiteVisible=!0},siteLabel(e){return this.siteList.find((t=>t.siteId==e)).siteName},SMZQ_abandonPriceRuleAdd:function(){this.configSetting.abandonPriceRule.push({price:0,maxPrice:0})},SMZQ_abandonPriceRuleDelete:function(e,t){this.configSetting.abandonPriceRule.splice(e,1)},SMZQ_AbandonPriceRule:function(e){const t=this.configSetting.abandonPriceRule[0].price,i=this.configSetting.abandonPriceRule[0].maxPrice;return console.log(t,i),e<t?3:e>i?2:1},SMZQ_AbandonPriceSet:function(e){this.configSetting.abandonPriceRule[0].price;const t=this.configSetting.abandonPriceRule[0].maxPrice;return e>t?t:e},SMZQ_searchForChainSupplier:function(e,t){const i=this.configSetting,n={pageSize:t=void 0===t?i.pageSize:t,pageNum:e,secondarySelectStatusList:[7],supplierTodoTypeList:[1]};return fetch("https://agentseller.temu.com/api/kiana/mms/robin/searchForSemiSupplier",{method:"POST",headers:{"Content-Type":"application/json",Cookie:i.Cookie,mallid:i.mallId},body:JSON.stringify(n)}).then((e=>e.json()))},SMZQ_rejectRemark:function(e){const t=this.configSetting,i={orderIds:e};return fetch("https://agentseller.temu.com/api/kiana/magnus/mms/price/bargain-no-bom/batch/info/query",{method:"POST",headers:{"Content-Type":"application/json",Cookie:t.Cookie,mallid:t.mallId},body:JSON.stringify(i)}).then((e=>e.json()))},SMZQ_reviewNoBom:function(e){const t=this.configSetting,i={priceOrderId:e};return fetch("https://seller.kuajingmaihuo.com/gmp/bg/magneto/api/price-review-order/no-bom/review",{method:"POST",headers:{"Content-Type":"application/json",Cookie:t.Cookie,mallid:t.mallId},body:JSON.stringify(i)}).then((e=>e.json()))},SMZQ_combineData:function(e){},SMZQ_bargainNoBom:function(e){const t=this.configSetting;return fetch("https://agentseller.temu.com/api/kiana/magnus/mms/price/bargain-no-bom/batch",{method:"POST",headers:{"Content-Type":"application/json",Cookie:t.Cookie,mallid:t.mallId},body:JSON.stringify(e)}).then((e=>e.json()))},HDSB_match_procution_data:function(e){const t=this.configSetting,i=t.activityPriceRule[0].price,n=t.activityPriceRule[0].maxPirce,a=t.activityFilerStrRule,s=t.activitySelectStrRule,o=t.activityTargetActivityStock,l=t.checkedSites;console.log(o);const c=this;c.fetchState=!0,c.logList=[];let r=e,m=[];if(a.length){c.logList.push({text:"排除掉所有SKU/SKC属性集包含的..."});let e=[],t=0;for(let i of r){i.activitySiteInfoList.some((e=>e.skcList.some((e=>this.HDSB_activityFilter(e.extCode)?(c.logList.push({text:`排除：skc属性集 ${e.extCode} 中包含设置的字符`}),!0):e.skuList.some((e=>Object.values(e.properties).some((e=>!!this.HDSB_activityFilter(e)&&(c.logList.push({text:`排除：sku属性集 ${e} 中包含设置的字符`}),!0)))))))))?t++:e.push(i)}c.logList.push({text:`统计：共${r.length} 条数据, 通过SKU/SKC属性集排除了 ${t} 条数据`}),r=e}if(s.length){c.logList.push({text:"筛选出所有SKU/SKC属性集包含的..."});let e=[],t=0;for(let i of r){i.activitySiteInfoList.some((e=>e.skcList.some((e=>this.HDSB_activitySelect(e.extCode)?(c.logList.push({text:`筛选：skc属性集 ${e.extCode} 中包含设置的字符`}),!0):e.skuList.some((e=>Object.values(e.properties).some((e=>!!this.HDSB_activitySelect(e)&&(c.logList.push({text:`筛选：sku属性集 ${e} 中包含设置的字符`}),!0)))))))))&&(t++,e.push(i))}c.logList.push({text:`统计：共${r.length} 条数据, 通过SKU/SKC属性集筛选出了 ${t} 条数据`}),r=e}if(l){c.logList.push({text:`筛选站点:${this.siteLabel(l)}的数据`});let e=r.filter((e=>e.sites.some((e=>e.siteId==l))));r=e,c.logList.push({text:`站点:${this.siteLabel(l)}的数据,共 ${r.length} 条数据`})}return m=r.map((e=>({productId:e.productId,activityStock:1*(o.length>0?o[0].num:e.targetActivityStock),siteInfoList:e.activitySiteInfoList.map((t=>({siteId:t.siteId,skcList:t.skcList.filter((e=>e.suggestActivityPrice>=i)).map((t=>{let i=t.suggestActivityPrice>n?n:t.suggestActivityPrice;return c.logList.push({text:`${e.productId}---价格 ${t.suggestActivityPrice}=>${i}`}),{skcId:t.skcId,skuList:t.skuList.map((e=>({skuId:e.skuId}))),activityPrice:i}}))}))).filter((e=>e.skcList.length>0)),sessionIds:e.suggestEnrollSessionIdList}))).filter((e=>e.siteInfoList.length>0)),m},ADTF_DataFilter:function(e){const t=this.configSetting,i=t.advertPriceRule[0].price,n=t.advertPriceRule[0].maxPirce,a=t.advertBudgetRule[0].budget,s=t.advertBudgetRule[0].roas;return(e=e.map((e=>({...e,priceMin:100*e.supply_price_min.replace(/￥/g,""),priceMax:100*e.supply_price_max.replace(/￥/g,"")})))).filter((e=>i&&n?e.priceMin==i&&e.priceMax==n:i?e.priceMin==i:n?e.priceMax==n:void 0)).map((e=>({budget:a,goods_id:e.goods_id,roas:1e4*s,site_id:e.site_list[0]})))},HDSB_execute:async function(){const e=this.configSetting,t=this.waitSeconds,i=this;i.fetchState=!0,i.logList=[];let n=!0,a=null;do{let s=await this.HDSB_getMatch(a);if(s.success){let o=s.result.matchList;n=s.result.hasMore,a=n?s.result.searchScrollContext:null,i.logList.push({text:`服务器返回数据成功, 共${o.length}条数据`});let l=this.HDSB_match_procution_data(o);if(l.length){i.logList.push({text:`等待${e.waitSeconds}秒后提交`}),await t(e.waitSeconds),(await this.HDSB_submit(l)).success?i.logList.push({text:`活动申报成功,该页总归申报${l.length}个`}):(i.logList.push({text:"活动申报失败"}),console.warn(`活动申报失败: ${data.errorMsg}`))}else i.logList.push({text:"该页没有符合条件的数据"})}else i.logList.push({text:"获取商品信息失败"}),console.warn(`获取商品信息失败: ${data.errorMsg}`);i.logList.push({text:`等待${e.waitSeconds}秒请求....`}),await t(e.waitSeconds)}while(n);i.fetchState=!1,i.logList.push({text:"全部处理完成"})},SMZQ_execute:async function(){const e=this.configSetting,t=this.waitSeconds,i=this.SMZQ_searchForChainSupplier,n=this.SMZQ_rejectRemark,a=this.SMZQ_AbandonPriceRule,s=this.SMZQ_AbandonPriceSet,o=(this.SMZQ_reviewNoBom,this.SMZQ_bargainNoBom),l=this.configSetting.checkedSites,c=this;c.fetchState=!0,c.logList=[],c.logInfo={index:0,totals:3,text:"正在拉取商品数据"};let r=0,m=e.pageNum;e.autoPage&&await i(1,1).then((t=>{console.log("getDataList(1,1): ",t),t.success?r=Math.ceil(t.result.total/e.pageSize):(c.logList.push({text:"获取商品信息失败"}),console.warn(`获取商品信息失败: ${t.errorMsg}`))})).catch((e=>{console.error("获取商品信息失败: ",e)}));let d=[],g=[],u=[];do{c.logList.push({text:`等待${e.waitSeconds}秒请求: 发送请求第${m}页`}),await t(e.waitSeconds),d.push(i(m)),m++,m>r&&c.logList.push({text:"请求商品列表结束,等待服务器返回数据"})}while(m<=r);Promise.all(d).then((async i=>{let a=[];i.forEach((e=>{e.success&&a.push(...e.result.dataList)})),c.logList.push({text:`服务器返回数据成功, 共${a.length}条数据`});let s=[];for(let e=0;e<a.length;e++){const t=a[e];for(let e=0;e<t.skcList.length;e++){const i=t.skcList[e];c.logList.push({text:`正在处理SKC: ${i.skcId}`});for(let e=0;e<i.supplierPriceReviewInfoList.length;e++){const t=i.supplierPriceReviewInfoList[e];0!=t.status?!l||t.siteList.some((e=>e.siteId==l))?s.push(t.priceOrderId):c.logList.push({text:`跳过: 不属于 ${this.siteLabel(l)} 站点`}):c.logList.push({text:"跳过: 价格申报中"})}}}let o=this.sliceArrayInChunks(s,700);for(let[i,a]of o.entries())c.logList.push({text:`等待${e.waitSeconds}秒请求第${i+1}片: 价格推荐信息=>700条一片`}),await t(e.waitSeconds),g.push(n(a));return c.logInfo={index:1,totals:3,text:"正在处理上新审核价格"},Promise.all(g)})).then((async i=>{c.logList.push({text:"请求商品列表结束,等待服务器返回数据"});let n=[];i.forEach((e=>{console.log(e),e.success&&n.push(...e.result.priceReviewItemList)})),c.logList.push({text:`服务器返回数据成功, 共${n.length}条数据`}),c.logList.push({text:"等待: 组合提交数据"});let l=n.map((e=>{let t=a(e.suggestSupplyPrice);return 3==t?{priceOrderId:e.id,supplierResult:t,items:e.skuInfoList.map((e=>({productSkuId:e.productSkuId})))}:{priceOrderId:e.id,supplierResult:t,items:e.skuInfoList.map((e=>({productSkuId:e.productSkuId,price:s(e.suggestSupplyPrice)})))}}));c.logList.push({text:`数据组合完毕: 共${l.length}条数据`});let r=this.sliceArrayInChunks(l,200);for(let[i,n]of r.entries())c.logList.push({text:`等待${e.waitSeconds}秒请求第${i+1}片: 数据提交=>200条一片`}),await t(e.waitSeconds),u.push(o({itemRequests:n}));return c.logInfo={index:2,totals:3,text:"正在处理最后数据提交"},Promise.all(u)})).then((async e=>{e.forEach(((e,t)=>{e.success?c.logList.push({text:`返回=>第${t+1}片: 成功`}):c.logList.push({text:`返回=>第${t+1}片: 失败`})})),c.logInfo={index:3,totals:3,text:"任务全部完成"}})).then((()=>{c.logList.push({text:"所有任务已完成"}),c.fetchState=!1})).catch((e=>{console.error("服务器返回数据失败: ",e)}))},ADTF_execute:async function(){const e=this.configSetting,t=this.waitSeconds,i=this,n=this.advertCurrentSiteId;i.fetchState=!0,i.logList=[];let a=!0;let s={page_number:1,page_size:50,is_gray:!1,list_id:this.generateUUIDv4()};n&&(s.site_id=n);do{let n=await this.ADTF_getDataList(s);if(n.success){let o=n.result.goods_info_list;a=n.has_more,a&&s.page_number++,i.logList.push({text:`服务器返回数据成功, 第${s.page_number}页，共${o.length}条数据`});let l=this.ADTF_DataFilter(o);if(console.log(l),l.length){i.logList.push({text:`第${s.page_number}页，筛选出${l.length}条数据`}),i.logList.push({text:`等待${e.waitSeconds}秒后提交`}),await t(e.waitSeconds);let n=await this.ADTF_submit(l);n.success?i.logList.push({text:`广告投放成功,该页总归申报${l.length}个`}):(i.logList.push({text:"广告投放失败"}),console.warn(`广告投放失败: ${n.error_msg}`))}else i.logList.push({text:"该页没有符合条件的数据"})}else i.logList.push({text:"获取商品信息失败"}),console.warn(`获取商品信息失败: ${n.error_msg}`);i.logList.push({text:`等待${e.waitSeconds}秒请求....`}),await t(e.waitSeconds),console.log(a)}while(a);i.fetchState=!1,i.logList.push({text:"全部处理完成"})},SPLB_pageQuery:function(e,t){const i=this.configSetting,n={pageSize:t=void 0===t?i.pageSize:t,page:e,skcJitStatus:3,skcSiteStatus:0};return fetch("https://seller.kuajingmaihuo.com/bg-visage-mms/product/skc/pageQuery",{method:"POST",headers:{"Content-Type":"application/json",Cookie:i.Cookie,mallid:i.mallId},body:JSON.stringify(n)}).then((e=>e.json()))},SPLB_signJIT:function(e){const t=this.configSetting,i={skcList:e};return fetch("https://seller.kuajingmaihuo.com/bg-visage-mms/product/agreement/batch/sign",{method:"POST",headers:{"Content-Type":"application/json",Cookie:t.Cookie,mallid:t.mallId},body:JSON.stringify(i)}).then((e=>e.json()))},SPLB_execute:async function(){const e=this.configSetting,t=this.waitSeconds,i=this.SPLB_pageQuery,n=this.SPLB_signJIT,a=this;a.fetchState=!0,a.logList=[];let s=0,o=e.pageNum;e.autoPage&&await i(1,1).then((t=>{console.log("pageQuery(1,1): ",t),t.success?s=Math.ceil(t.result.total/e.pageSize):(a.logList.push({text:"获取商品信息失败"}),console.warn(`获取商品信息失败: ${t.errorMsg}`))})).catch((e=>{console.error("获取商品信息失败: ",e)}));let l=[];do{a.logList.push({text:`等待${e.waitSeconds}秒请求: 发送请求第${o}页`}),await t(e.waitSeconds),l.push(i(o)),o++,o>s&&a.logList.push({text:"请求商品列表结束,等待服务器返回数据"})}while(o<=s);Promise.all(l).then((async i=>{let s=[];i.forEach((e=>{e.success&&s.push(...e.result.pageItems)})),a.logList.push({text:`服务器返回数据成功, 共${s.length}条数据`}),console.log(s);let o=[];for(let e=0;e<s.length;e++){const t=s[e];o.push({productId:t.productId,productSkcId:t.productSkcId})}let l=[];for(let e=0;e<o.length;e+=20)l.push(o.slice(e,e+20));if(l.length)for(let i=0;i<l.length;i++){const s=l[i];a.logList.push({text:`等待${e.waitSeconds}秒请求: 第${i+1}次签署,签署${s.length}个`}),await t(e.waitSeconds),await n(s).then((e=>{if(e.success){if(a.logList.push({text:`签署成功: ${e.result.successNum}`}),a.logList.push({text:`签署失败: ${e.result.failedNum}`}),e.result.failedDetailList.length)for(let t=0;t<e.result.failedDetailList.length;t++){const i=e.result.failedDetailList[t];a.logList.push({text:`Skc: ${i.productSkcId}, ${i.errorMsg}`})}}else console.warn(`签署失败: ${e.errorMsg}`)})).catch((e=>{console.error("签署失败: ",e)}))}else a.logList.push({text:"需要签署为空"});a.fetchState=!1})).catch((e=>{console.error("服务器返回数据失败: ",e)}))},HDSB_activityPirceAdd:function(){this.configSetting.activityPriceRule.push({price:0,maxPirce:0})},HDSB_activityTargetActivityStockAdd:function(){this.configSetting.activityTargetActivityStock.push({num:""})},HDSB_activityFilerStrAdd:function(){this.configSetting.activityFilerStrRule.push({str:""})},HDSB_activitySelectStrAdd:function(){this.configSetting.activitySelectStrRule.push({str:""})},HDSB_activityTargetActivityStockDel:function(e){this.configSetting.activityTargetActivityStock.splice(e,1)},HDSB_activityFilerStrDel:function(e){this.configSetting.activityFilerStrRule.splice(e,1)},HDSB_activitySelectStrDel:function(e){this.configSetting.activitySelectStrRule.splice(e,1)},HDSB_activityPirceDelete:function(e,t){this.configSetting.activityPriceRule.splice(e,1)},HDSB_activityFilter:function(e){return this.configSetting.activityFilerStrRule.some((t=>new RegExp(t.str,"i").test(e)))},HDSB_activitySelect:function(e){return this.configSetting.activitySelectStrRule.some((t=>new RegExp(t.str,"i").test(e)))},handleClick:async function(e){await this.checkToken()?("上新生命周期"==e&&this.SMZQ_execute(),"批量签署JIT规则"==e&&this.SPLB_execute(),"批量活动申报"==e&&this.HDSB_execute(),"批量广告投放"==e&&this.ADTF_execute(),this.clickState=e,this.dialogLogVisible=!0):this.settingDrawer=!1},sliceArrayInChunks:function(e,t){const i=[];let n=0;for(;n<e.length;)i.push(e.slice(n,n+t)),n+=t;return i},generateUUIDv4:function(e={},t,i){const n=(()=>{if("undefined"!=typeof crypto&&crypto.getRandomValues)return crypto.getRandomValues.bind(crypto);if("undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues)return msCrypto.getRandomValues.bind(msCrypto);throw new Error("不支持crypto.getRandomValues()，无法生成安全的随机UUID")})(),a=e.random||(e.rng||(()=>{const e=new Uint8Array(16);return n(e),e}))();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){i=i||0;for(let e=0;e<16;e++)t[i+e]=a[e];return t}const s=[];for(let e=0;e<256;e++)s.push((e+256).toString(16).substr(1));return[s[a[0]]+s[a[1]]+s[a[2]]+s[a[3]],s[a[4]]+s[a[5]],s[a[6]]+s[a[7]],s[a[8]]+s[a[9]],s[a[10]]+s[a[11]]+s[a[12]]+s[a[13]]+s[a[14]]+s[a[15]]].join("-")},ADTF_advertPriceRuleAdd:function(){this.configSetting.advertPriceRule.push({price:0,maxPrice:0})},ADTF_advertPriceRuleDelete:function(e){this.configSetting.advertPriceRule.splice(e,1)},ADTF_advertBudgetRuleAdd:function(){this.configSetting.advertBudgetRule.push({budget:0,roas:0})},ADTF_advertBudgetRuleDelete:function(e){this.configSetting.advertBudgetRule.splice(e,1)}},watch:{configSetting:{handler(e,t){this.$nextTick((()=>{unsafeWindow.document.body.classList.toggle("is-blockPopUps",e.blockPopUps),GM_setValue("configSetting",e)}))},deep:!0}},computed:{ADTF_currentSiteName(){return this.advertCurrentSiteId&&this.advertSites.length>0?this.advertSites.find((e=>e.site_id===this.advertCurrentSiteId)).site_name:"全部"}}},n=Vue.createApp(i);n.use(ElementPlus),n.mount("#vueApp")}();